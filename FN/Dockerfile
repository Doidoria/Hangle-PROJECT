### 1ë‹¨ê³„: React ì•± ë¹Œë“œ ###
FROM node:20-alpine AS build

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì˜ì¡´ì„± ì„¤ì¹˜
COPY package*.json ./
RUN npm install

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ ë° ë¹Œë“œ
COPY . .
RUN npm run build


### 2ë‹¨ê³„: Nginx ì´ë¯¸ì§€ë¡œ ì •ì  íŒŒì¼ ë°°í¬ ###
FROM nginx:alpine

# ë¹Œë“œëœ ì •ì  íŒŒì¼ì„ Nginx ì›¹ ë£¨íŠ¸ë¡œ ë³µì‚¬
COPY --from=build /app/build /usr/share/nginx/html

# ğŸš¨ 403 Forbidden ìµœì¢… í•´ê²°: Nginx ì‚¬ìš©ìì—ê²Œ íŒŒì¼ ì†Œìœ ê¶Œì„ ëª…ì‹œì ìœ¼ë¡œ ë¶€ì—¬ ğŸš¨
# ì´ ëª…ë ¹ì´ Nginxê°€ ì›¹ ë£¨íŠ¸(/usr/share/nginx/html)ì˜ ëª¨ë“  íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.
RUN chown -R nginx:nginx /usr/share/nginx/html

# (ì„ íƒ) ì»¤ìŠ¤í…€ Nginx ì„¤ì • íŒŒì¼ì´ ìˆì„ ê²½ìš° ë³µì‚¬
COPY nginx.conf /etc/nginx/conf.d/default.conf

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 80

# Nginx ì‹¤í–‰
CMD ["nginx", "-g", "daemon off;"]